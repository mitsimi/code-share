<!DOCTYPE html>
<head>
    <!-- Basic page metadata -->
    <title>SnippetShare</title>
    <meta name="author" content="Noah FÃ¼reder" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Stylesheet reference -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- External libraries -->
    <script src="https://unpkg.com/lucide@latest"></script>  <!-- Icon library -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>  <!-- Vue.js framework -->
</head>
<body>
    <!-- Root Vue application container -->
    <div id="app" class="site-container">
        <!-- Header section -->
        <header>
            <div class="header-container">
                <div href="#" class="header-logo-name">
                    <!-- Logo with fallback -->
                    <img src="logo.svg" onerror="this.src='https://img.logoipsum.com/284.svg'" alt="SnippetShare Logo" class="header-logo"/>
                    <span>SnippetShare</span>
                </div>
            </div>
        </header>

        <!-- Main content area -->
        <main>
            <!-- Card grid container -->
            <div class="card-container">                     
                <!-- Dynamic card generation using Vue v-for -->
                <div v-for="card in cards" :key="card.id" class="card">
                    <h2 class="card-title">{{ card.title }}</h2>
                    <div class="card-content">
                        <pre><code>{{ card.code }}</code></pre>
                    </div>
                    <div class="card-footer">
                        <span>{{ card.author }}</span>
                        <!-- Like button with conditional classes -->
                        <div class="card-likes" 
                             :class="{ 
                                'card-liked': card.isLiked, 
                                'devils-disciple': card.likes < 0 
                             }"
                             @click.stop="toggleLike(card)">
                            <span>{{ card.likes }}</span>
                            <i data-lucide="heart" :fill="card.isLiked ? 'currentColor' : 'none'" style="height: 1rem; width: 1rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer section -->
        <footer>
            <div class="footer-container">
                <div class="footer-text">
                    <p style="text-align: center;">
                        This project was created for the course 
                        <a href="https://ssw.jku.at/Teaching/Lectures/IntroWebDev/2025/">Special Topic: Introduction to Full Stack Web Development</a>
                        at Johannes Kepler University.
                    </p>
                </div>
            </div>  
        </footer>

        <!-- Floating action button -->
        <button class="floating-btn" @click="showModal = true">
            <i data-lucide="plus" style="height: 1.5rem; width: 1.5rem;"></i>
        </button>
        
        <!-- Modal for new snippet submission -->
        <div class="modal" :class="{ 'show': showModal }" @click="closeModalOutside">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Submit a new snippet</h2>
                    <button class="close-btn" @click="showModal = false">&times;</button>
                </div>
                <!-- Snippet submission form -->
                <form class="snippet-form" @submit.prevent="submitSnippet">
                    <label for="title-modal">Title: </label>
                    <input type="text" v-model="newSnippet.title" id="title-modal" required />
                
                    <label for="snippet-modal">Snippet: </label>
                    <textarea 
                        v-model="newSnippet.code" 
                        id="snippet-modal" 
                        required
                        @keydown="handleTabKey"
                    ></textarea>
                
                    <label for="name-modal">Your Name: </label>
                    <input type="text" v-model="newSnippet.author" id="name-modal" required />
                    
                    <input class="submit-button" type="submit" value="Submit" />
                </form>
            </div>
        </div>

        <!-- Toast notification container -->
        <div class="toast-container">
            <div class="toast" :class="{ 'show-toast': showToast }">
                <div class="toast-content">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    <span>{{ toastMessage }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Vue application script -->
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        const { createApp } = Vue
        
        // Create Vue application
        createApp({
            // Application state
            data() {
                return {
                    showModal: false,
                    showToast: false,
                    toastMessage: '',
                    toastTimeout: null,
                    newSnippet: {
                        title: '',
                        code: '',
                        author: '',
                    },
                    cards: [
                        {
                            id: 1,
                            title: "Vue 3 Composition API Example",
                            code: `import { ref, computed } from 'vue'
export default {
    setup() {
        const count = ref(0)
        const double = computed(() => count.value * 2)

        function increment() {
            count.value++
        }

        return {
            count,
            double,
            increment
        }
    }
}`,
                            author: "John Doe",
                            likes: 290,
                            isLiked: true
                        },
                        {
                            id: 2,
                            title: "React Hooks: useEffect Example",
                            code: `import React, { useState, useEffect } from 'react';

function Example() {
    const [count, setCount] = useState(0);

    useEffect(() => {
    document.title = \`Count: \${count}\`;
    });

    return (
    <div>
        <p>You clicked {count} times</p>
        <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
    );
}`,
                            author: "Alice Johnson",
                            likes: 104,
                            isLiked: true
                        },
                        {
                            id: 3,
                            title: "Shell Script Example",
                            code: `#!/bin/bash

echo "Hello, World!"`,
                            author: "Paula Cyan",
                            likes: 17,
                            isLiked: false
                        },
                        {
                            id: 4,
                            title: "Java Basic Hello World",
                            code: `public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }
}`,
                            author: "Ivy Purple",
                            likes: 3,
                            isLiked: false
                        },
                        {
                            id: 5,
                            title: "Go Simple HTTP Server",
                            code: `package main

import (
    "fmt"
    "net/http"
)

func handler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "Hello, World!")
}

func main() {
    http.HandleFunc("/", handler)
    http.ListenAndServe(":8080", nil)
}`,
                            author: "Grace Yellow",
                            likes: 561,
                            isLiked: false
                        },
                        {
                            id: 6,
                            title: "Python Data Analysis with Pandas",
                            code: `import pandas as pd

data = {'Name': ['Tom', 'Jerry', 'Mickey'], 'Age': [20, 21, 19]}
df = pd.DataFrame(data)
print(df.describe())`,
                            author: "Guido van Rossum",
                            likes: -666,
                            isLiked: false
                        }
                    ]
                }
            },
            // Application methods
            methods: {
                // Toggle like status for a card
                toggleLike(card) {
                    card.isLiked = !card.isLiked;
                    card.likes += card.isLiked ? 1 : -1;
                },
                // Close modal when clicking outside
                closeModalOutside(event) {
                    if (event.target.classList.contains('modal')) {
                        this.showModal = false;
                    }
                },
                // Submit new snippet
                submitSnippet() {
                    const newId = Math.max(...this.cards.map(card => card.id)) + 1;
                    
                    const newCard = {
                        id: newId,
                        title: this.newSnippet.title,
                        code: this.newSnippet.code,
                        author: this.newSnippet.author,
                        likes: 0,
                        isLiked: false
                    };
                    
                    this.cards.unshift(newCard);
                    
                    // Reset form
                    this.newSnippet = {
                        title: '',
                        code: '',
                        author: ''
                    };
                    
                    this.showModal = false;
                    this.showToastMessage(`"${newCard.title}" has been added successfully!`);
                },
                // Show toast message
                showToastMessage(message) {
                    if (this.toastTimeout) {
                        clearTimeout(this.toastTimeout);
                    }
                    
                    this.toastMessage = message;
                    this.showToast = true;
                    this.toastTimeout = setTimeout(() => {
                        this.showToast = false;
                    }, 3000);
                },
                // Handle tab key in textarea
                handleTabKey(event) {
                    if (event.key === 'Tab') {
                        event.preventDefault();
                        
                        const textarea = event.target;
                        const start = textarea.selectionStart;
                        const end = textarea.selectionEnd;
                        const value = textarea.value;
                        
                        if (start !== end && value.substring(start, end).includes('\n')) {
                            const selectedText = value.substring(start, end);
                            const lines = selectedText.split('\n');
                            
                            const newLines = lines.map(line => 
                                event.shiftKey ? this.removeTab(line) : '    ' + line
                            );
                            const newText = newLines.join('\n');
                            
                            textarea.value = value.substring(0, start) + newText + value.substring(end);
                            textarea.selectionStart = start;
                            textarea.selectionEnd = start + newText.length;
                        } else {
                            const spaces = '    '; 
                            textarea.value = value.substring(0, start) + spaces + value.substring(end);
                            textarea.selectionStart = textarea.selectionEnd = start + spaces.length;
                        }
                        
                        this.newSnippet.code = textarea.value;
                    }
                },
                // Remove tab from line
                removeTab(line) {
                    if (line.startsWith('\t')) {
                        return line.substring(1);
                    }
                    if (line.startsWith('    ')) {
                        return line.substring(4);
                    }
                    if (line.startsWith('  ')) {
                        return line.substring(2);
                    }
                    return line;
                }
            }
        }).mount('#app')
    </script>      
</body>
</html>
